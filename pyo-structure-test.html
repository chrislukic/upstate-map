<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PYO Fruit Farms Structure Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            color: #333;
            margin-bottom: 10px;
        }
        .popup {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-height: 100px;
            font-family: Arial, sans-serif;
        }
        .popup__title {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            line-height: 1.3;
        }
        .popup__subtitle {
            color: #666;
            font-size: 13px;
            margin-bottom: 8px;
            font-style: italic;
        }
        .popup__meta-container {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin: 4px 0;
        }
        .popup__meta {
            color: #666;
            font-size: 12px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .popup__meta--warning {
            color: #ff6b6b;
            font-weight: 500;
        }
        .popup__description {
            margin: 8px 0;
            font-size: 14px;
            line-height: 1.5;
            color: #444;
        }
        .popup__fruit-info {
            margin: 8px 0;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .popup__fruit-item {
            margin: 4px 0;
            padding: 4px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .popup__fruit-item:last-child {
            border-bottom: none;
        }
        .popup__fruit-item small {
            display: block;
            color: #666;
            font-size: 11px;
            margin-top: 2px;
        }
        .popup__links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            font-size: 13px;
        }
        .popup__link {
            color: #4CAF50;
            text-decoration: none;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .popup__link:hover {
            color: #45a049;
            text-decoration: underline;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .popup__link i {
            color: inherit;
            font-size: 12px;
        }
        .json-display {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>PYO Fruit Farms Structure Test</h1>
        <p>This page demonstrates the new consolidated PYO fruit farms structure.</p>
        
        <div class="test-section">
            <h3 class="test-title">New JSON Structure</h3>
            <p>The new structure consolidates all fruit farms into a single JSON file with each farm having an array of fruit types they offer.</p>
            <div class="json-display" id="json-structure"></div>
        </div>
        
        <div class="test-section">
            <h3 class="test-title">Farm Popup Examples</h3>
            <p>Here are examples of how the new popup structure displays farm information:</p>
            <div id="farm-popups"></div>
        </div>
    </div>

    <script>
        // Mock map instance for testing
        const mockMap = {
            tripPlan: null,
            formatAddress: function(address) {
                return address;
            }
        };

        // Mock popup builder classes
        class PopupBuilder {
            constructor(mapInstance) {
                this.map = mapInstance;
                this.tripPlan = mapInstance.tripPlan;
            }

            createBasePopup(data, type) {
                return {
                    content: {
                        title: this.getTitle(data, type),
                        subtitle: this.getSubtitle(data, type),
                        meta: this.getMeta(data, type),
                        description: this.getDescription(data, type),
                        customContent: this.getCustomContent(data, type)
                    },
                    links: {
                        website: this.getWebsiteLink(data),
                        googleMaps: this.getGoogleMapsLink(data),
                        directions: this.getDirectionsLink(data)
                    },
                    coordinates: this.getCoordinates(data),
                    maxWidth: this.getMaxWidth(type),
                    className: this.getClassName(type)
                };
            }

            getTitle(data, type) {
                return data.name || data.title || 'Unknown';
            }

            getSubtitle(data, type) {
                return data.location || data.address || null;
            }

            getMeta(data, type) {
                return [];
            }

            getDescription(data, type) {
                return data.description || data.notes || null;
            }

            getCustomContent(data, type) {
                return null;
            }

            getWebsiteLink(data) {
                if (!data.website) return null;
                return {
                    url: data.website,
                    text: 'Website',
                    icon: 'fa-external-link',
                    className: 'popup__link--secondary'
                };
            }

            getGoogleMapsLink(data) {
                if (!data.place_id) return null;
                const url = `https://www.google.com/maps/place/?q=place_id:${data.place_id}`;
                return {
                    url: url,
                    text: 'View on Google Maps',
                    icon: 'fa-map-marker',
                    className: 'popup__link--secondary'
                };
            }

            getDirectionsLink(data) {
                return null; // No trip plan in this test
            }

            getCoordinates(data) {
                if (data.lat && data.lng) {
                    return [data.lat, data.lng];
                }
                return null;
            }

            getMaxWidth(type) {
                return 350;
            }

            getClassName(type) {
                return `popup--${type}`;
            }
        }

        class FarmPopupBuilder extends PopupBuilder {
            getMeta(data, type) {
                const meta = [];
                
                if (data.address) meta.push(data.address);
                
                // Add fruit types available
                if (data.fruits && data.fruits.length > 0) {
                    const fruitTypes = data.fruits.map(fruit => fruit.type).join(', ');
                    meta.push(`<strong>Available:</strong> ${fruitTypes}`);
                }
                
                // Add seasonal status for each fruit
                if (data.fruits && data.fruits.length > 0) {
                    const inSeasonFruits = data.fruits.filter(fruit => this.getSeasonalStatus(fruit, type));
                    const outOfSeasonFruits = data.fruits.filter(fruit => !this.getSeasonalStatus(fruit, type));
                    
                    if (outOfSeasonFruits.length > 0) {
                        meta.push('<span class="popup__meta--warning"><strong>‚ö†Ô∏è Some fruits out of season</strong></span>');
                    }
                }
                
                return meta;
            }

            getDescription(data) {
                // Combine notes from all fruits
                if (data.fruits && data.fruits.length > 0) {
                    const allNotes = data.fruits
                        .map(fruit => fruit.notes)
                        .filter(note => note && note.trim())
                        .join(' ‚Ä¢ ');
                    return allNotes || '';
                }
                return data.notes || '';
            }

            getCustomContent(data) {
                let content = '';
                
                // Add organic badges for each fruit
                if (data.fruits && data.fruits.length > 0) {
                    const organicFruits = data.fruits.filter(fruit => fruit.organic);
                    if (organicFruits.length > 0) {
                        const organicTypes = organicFruits.map(fruit => fruit.type).join(', ');
                        content += `<div style="color: #4CAF50; font-size: 14px;">üå± Organic: ${organicTypes}</div>`;
                    }
                }
                
                // Add fruit-specific information
                if (data.fruits && data.fruits.length > 0) {
                    content += '<div class="popup__fruit-info">';
                    data.fruits.forEach(fruit => {
                        const seasonStatus = this.getSeasonalStatus(fruit, type) ? '‚úÖ' : '‚ùå';
                        const reservationText = fruit.reservation_required ? ' (Reservation Required)' : '';
                        content += `<div class="popup__fruit-item">
                            <strong>${fruit.type.charAt(0).toUpperCase() + fruit.type.slice(1)}</strong> ${seasonStatus}
                            <small>${fruit.season_description}${reservationText}</small>
                        </div>`;
                    });
                    content += '</div>';
                }
                
                return content;
            }

            getSeasonalStatus(fruit, type) {
                // Mock seasonal status - in real implementation this would check current week
                return Math.random() > 0.3; // 70% chance of being in season
            }
        }

        // Create popup content function
        function createPopup(options) {
            let content, links, coordinates, maxWidth;
            
            if (options.content && options.links) {
                content = options.content;
                links = options.links;
                coordinates = options.coordinates;
                maxWidth = options.maxWidth || 350;
            } else {
                content = {
                    title: options.title,
                    subtitle: options.subtitle,
                    meta: options.meta || [],
                    description: options.description,
                    customContent: options.customContent || ''
                };
                links = {
                    website: options.website ? { url: options.website, text: 'Website', icon: 'fa-external-link', className: 'popup__link--secondary' } : null,
                    googleMaps: options.google_maps_url ? { url: options.google_maps_url, text: 'View on Google Maps', icon: 'fa-map-marker', className: 'popup__link--secondary' } : null,
                    directions: null
                };
                coordinates = options.coordinates;
                maxWidth = options.maxWidth || 350;
            }
            
            const metaHtml = content.meta && content.meta.length > 0 ? 
                `<div class="popup__meta-container">${content.meta.map(item => `<span class="popup__meta">${item}</span>`).join('')}</div>` : '';
            
            const linkElements = [];
            
            if (links.website) {
                linkElements.push(renderLink(links.website));
            }
            
            if (links.googleMaps) {
                linkElements.push(renderLink(links.googleMaps));
            }
            
            if (links.directions) {
                linkElements.push(renderLink(links.directions));
            }
            
            const linksHtml = linkElements.length > 0 ? 
                `<div class="popup__links">${linkElements.join(' ‚Ä¢ ')}</div>` : '';
            
            const descriptionHtml = content.description ? 
                `<div class="popup__description">${content.description}</div>` : '';
            
            const subtitleHtml = content.subtitle ? 
                `<div class="popup__subtitle">${content.subtitle}</div>` : '';
            
            return `
                <div class="popup">
                    <h3 class="popup__title">${content.title}</h3>
                    ${subtitleHtml}
                    ${metaHtml}
                    ${descriptionHtml}
                    ${content.customContent || ''}
                    ${linksHtml}
                </div>
            `;
        }

        function renderLink(linkObj) {
            if (!linkObj) return '';
            return `<a href="${linkObj.url}" target="_blank" rel="noopener" class="popup__link ${linkObj.className}">
                <i class="fa ${linkObj.icon}"></i> ${linkObj.text}
            </a>`;
        }

        // Sample data using the new structure
        const sampleFarms = [
            {
                "name": "Fishkill Farms",
                "address": "9 Fishkill Farm Rd, Hopewell Junction, NY 12533",
                "lat": 41.5180421,
                "lng": -73.82306009999999,
                "website": "https://www.fishkillfarms.com/",
                "place_id": "ChIJbUwNsDRI3YkR8aUEiWs_1MU",
                "fruits": [
                    {
                        "type": "apples",
                        "notes": "Organic & eco-grown blocks; book timed PYO slots in season",
                        "season_description": "Apple picking season typically runs from September through November",
                        "season_start_week": 34,
                        "season_end_week": 42,
                        "reservation_required": true,
                        "season": "Fall",
                        "organic": true
                    },
                    {
                        "type": "strawberries",
                        "notes": "Organic strawberries; early June PYO with online reservations",
                        "season_description": "Strawberry picking season typically runs from late May through early July",
                        "season_start_week": 22,
                        "season_end_week": 28,
                        "reservation_required": true,
                        "season": "Spring/Summer",
                        "organic": true
                    }
                ]
            },
            {
                "name": "Wilkens Fruit & Fir Farm",
                "address": "1335 White Hill Rd, Yorktown Heights, NY 10598",
                "lat": 41.2780064,
                "lng": -73.825319,
                "website": "https://wilkensfarm.com/",
                "place_id": "ChIJZXLvw863wokR2JyXrb1MnAw",
                "fruits": [
                    {
                        "type": "apples",
                        "notes": "Classic Westchester PYO; bakery & market on site",
                        "season_description": "Apple picking season typically runs from September through November",
                        "season_start_week": 34,
                        "season_end_week": 42,
                        "reservation_required": false,
                        "season": "Fall",
                        "organic": false
                    }
                ]
            }
        ];

        // Display JSON structure
        document.getElementById('json-structure').textContent = JSON.stringify(sampleFarms, null, 2);

        // Create popups
        const farmBuilder = new FarmPopupBuilder(mockMap);
        const farmPopupsContainer = document.getElementById('farm-popups');
        
        sampleFarms.forEach((farm, index) => {
            const popupContent = createPopup(farmBuilder.createBasePopup(farm, 'farm'));
            const farmSection = document.createElement('div');
            farmSection.innerHTML = `
                <h4>Farm ${index + 1}: ${farm.name}</h4>
                ${popupContent}
            `;
            farmSection.style.marginBottom = '20px';
            farmSection.style.padding = '15px';
            farmSection.style.border = '1px solid #ddd';
            farmSection.style.borderRadius = '5px';
            farmPopupsContainer.appendChild(farmSection);
        });
    </script>
</body>
</html>


